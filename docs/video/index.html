<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>VIP视频解析</title>
    <link rel="stylesheet" href="https://medfav.imfast.io/video/style.css">
    <link rel="stylesheet" href="https://medfav.imfast.io/video/index.css">
    <script src="https://medfav.imfast.io/video/vue.js"></script>
    <script src="https://medfav.imfast.io/video/index.js"></script>
    <script src="https://medfav.imfast.io/video/axios.min.js"></script>
    <script src="https://medfav.imfast.io/video/jquery.min.js"></script>
</head>
<body>
    <div>
        <el-container id="page">
            <el-header>
                <div>VIP视频解析</div>
            </el-header>
            <el-main>
                <div>
                    <iframe id="iframe" :src="playUrl" frameborder="0" allowfullscreen="true" >
                        请选择服务，并输入视频所在页面连接
                    </iframe>
                </div>
                <div id="inputUrl">
                    <el-input placeholder="请输入内容" autofocus clearable v-model="input" @input="iputChange" class="input-with-select">
                        <el-select v-model="select" slot="prepend" placeholder="请选择">
                            <el-option v-for="(item,index) in urlList" :label="item.label" :value="item.value"></el-option>
                        </el-select>
                        <el-button disabled :disabled ="btnStatus" title="点击开始解析" id="play" slot="append" @click="play" icon="el-icon-video-play"></el-button>
                    </el-input>
                </div>
            </el-main>
            <el-footer>
                <div>All Content &copy; 蓝天之约 2020.10</div>
            </el-footer>
        </el-container>
    </div>
    <script>
        new Vue({
            el: '#page',
            data: function() {
                return { 
                    urlList:[],
                    input:"",
                    select:"",
                    playUrl:"https://medfav.imfast.io/video/readme.html",
                    btnStatus:true
                }
            },
            methods:{
                iputChange(){
                    var patt = /http(s{0,1}):\/\/[\w-]+(\.[\w-]+)+/i;
                    if (this.input.length > 0 && patt.test(this.input)) {
                        this.btnStatus = false;
                    }else{
                        this.btnStatus = true;
                    }/^(((ht|f)tps?):\/\/)?[\w-]+(\.[\w-]+)+([\w.,@?^=%&:\/~+#-]*[\w@?^=%&\/~+#-])?$/
                },
                play(){
                    this.playUrl = this.select + this.input;
                }
            },
            mounted: function() {
                const url="https://medfav.imfast.io/video/data.json";
                const _this=this;
                $.ajax({
                    url:url,
                    success:function(res){
                        console.log(res)
                        _this.urlList = res;
                        _this.select = res[0].value;
                        _this.input = getQueryVariable(location.href);
                        if(_this.input!=""){
                             _this.btnStatus = false;
                            _this.$nextTick(function () {
                                _this.iputChange();
                                if(!_this.btnStatus){
                                    _this.play();
                                }
                            })
                        }
                    }
                });
                function getQueryVariable(url){
                    var query = window.location.search.substring(1);
                    var vars = query.split("&");
                    for (var i=0;i<vars.length;i++) {
                            var pair = vars[i].split("=");
                            if(pair[0].toLowerCase() == "url"){return pair[1];}
                    }
                    return("");
                }
            }
        })
    </script>
</body>
</html>